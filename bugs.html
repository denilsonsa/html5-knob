
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>HTML5 &lt;x-knob&gt; rotating knob web component</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!--
Required for browsers that do not yet support the latest technologies.
http://webcomponents.org/
https://github.com/webcomponents/webcomponentsjs/releases
-->
<script type="text/javascript">
if (!document.registerElement) {
	document.writeln(decodeURI('%3Cscript%20src=%22https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/0.7.12/webcomponents.min.js%22%20type=%22text/javascript%22%3E%3C/script%3E'));
}
</script>

<script src="xknob.js" type="text/javascript" async></script>
<link href="xknob.css" type="text/css" rel="stylesheet">

<style type="text/css">
html, body {
	background: white;
	color: black;
}
h2 {
	border-top: 1px solid black;
	margin: 2em 0 1ex;
}
:target {
	background: #eeeeec;
}
input[type="number"] {
	width: 4em;
}
</style>

<svg style="display: none;">
	<defs>
		<symbol id="chromatic-wheel-labeled" viewBox="-5 -5 10 10">
			<g visibility="hidden">
				<path id="circle-section" d="M-0.2614672282429745,-2.988584094275237 -0.34862297099063266,-3.984778792366982 0.34862297099063266,-3.984778792366982 0.2614672282429745,-2.988584094275237 z"/>
			</g>
			<!-- Any referenced element inside this symbol must be defined also inside it, otherwise <x-knob> won't copy it. -->
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(0, 100%, 50%)" transform="rotate(0)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(10, 100%, 50%)" transform="rotate(10)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(20, 100%, 50%)" transform="rotate(20)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(30, 100%, 50%)" transform="rotate(30)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(40, 100%, 50%)" transform="rotate(40)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(50, 100%, 50%)" transform="rotate(50)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(60, 100%, 50%)" transform="rotate(60)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(70, 100%, 50%)" transform="rotate(70)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(80, 100%, 50%)" transform="rotate(80)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(90, 100%, 50%)" transform="rotate(90)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(100, 100%, 50%)" transform="rotate(100)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(110, 100%, 50%)" transform="rotate(110)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(120, 100%, 50%)" transform="rotate(120)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(130, 100%, 50%)" transform="rotate(130)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(140, 100%, 50%)" transform="rotate(140)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(150, 100%, 50%)" transform="rotate(150)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(160, 100%, 50%)" transform="rotate(160)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(170, 100%, 50%)" transform="rotate(170)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(180, 100%, 50%)" transform="rotate(180)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(190, 100%, 50%)" transform="rotate(190)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(200, 100%, 50%)" transform="rotate(200)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(210, 100%, 50%)" transform="rotate(210)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(220, 100%, 50%)" transform="rotate(220)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(230, 100%, 50%)" transform="rotate(230)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(240, 100%, 50%)" transform="rotate(240)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(250, 100%, 50%)" transform="rotate(250)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(260, 100%, 50%)" transform="rotate(260)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(270, 100%, 50%)" transform="rotate(270)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(280, 100%, 50%)" transform="rotate(280)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(290, 100%, 50%)" transform="rotate(290)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(300, 100%, 50%)" transform="rotate(300)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(310, 100%, 50%)" transform="rotate(310)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(320, 100%, 50%)" transform="rotate(320)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(330, 100%, 50%)" transform="rotate(330)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(340, 100%, 50%)" transform="rotate(340)"/>
			<use xlink:href="#circle-section" x="0" y="0" fill="hsl(350, 100%, 50%)" transform="rotate(350)"/>

			<g text-anchor="middle" dominant-baseline="central" font-family="Arial, sans-serif" font-size="0.4px">
				<text x="0" y="-4.5" transform="rotate(0)">0</text>
				<text x="0" y="-4.5" transform="rotate(10)">10</text>
				<text x="0" y="-4.5" transform="rotate(20)">20</text>
				<text x="0" y="-4.5" transform="rotate(30)">30</text>
				<text x="0" y="-4.5" transform="rotate(40)">40</text>
				<text x="0" y="-4.5" transform="rotate(50)">50</text>
				<text x="0" y="-4.5" transform="rotate(60)">60</text>
				<text x="0" y="-4.5" transform="rotate(70)">70</text>
				<text x="0" y="-4.5" transform="rotate(80)">80</text>
				<text x="0" y="-4.5" transform="rotate(90)">90</text>
				<text x="0" y="-4.5" transform="rotate(100)">100</text>
				<text x="0" y="-4.5" transform="rotate(110)">110</text>
				<text x="0" y="-4.5" transform="rotate(120)">120</text>
				<text x="0" y="-4.5" transform="rotate(130)">130</text>
				<text x="0" y="-4.5" transform="rotate(140)">140</text>
				<text x="0" y="-4.5" transform="rotate(150)">150</text>
				<text x="0" y="-4.5" transform="rotate(160)">160</text>
				<text x="0" y="-4.5" transform="rotate(170)">170</text>
				<text x="0" y="-4.5" transform="rotate(180)">180</text>
				<text x="0" y="-4.5" transform="rotate(190)">190</text>
				<text x="0" y="-4.5" transform="rotate(200)">200</text>
				<text x="0" y="-4.5" transform="rotate(210)">210</text>
				<text x="0" y="-4.5" transform="rotate(220)">220</text>
				<text x="0" y="-4.5" transform="rotate(230)">230</text>
				<text x="0" y="-4.5" transform="rotate(240)">240</text>
				<text x="0" y="-4.5" transform="rotate(250)">250</text>
				<text x="0" y="-4.5" transform="rotate(260)">260</text>
				<text x="0" y="-4.5" transform="rotate(270)">270</text>
				<text x="0" y="-4.5" transform="rotate(280)">280</text>
				<text x="0" y="-4.5" transform="rotate(290)">290</text>
				<text x="0" y="-4.5" transform="rotate(300)">300</text>
				<text x="0" y="-4.5" transform="rotate(310)">310</text>
				<text x="0" y="-4.5" transform="rotate(320)">320</text>
				<text x="0" y="-4.5" transform="rotate(330)">330</text>
				<text x="0" y="-4.5" transform="rotate(340)">340</text>
				<text x="0" y="-4.5" transform="rotate(350)">350</text>
			</g>
		</symbol>

		<!-- Driving wheel clipart from https://openclipart.org/detail/172010/driving-wheel -->
		<symbol id="driving-wheel-as-image" viewBox="0 0 1 1">
			<image xlink:href="drivingwheel.svg" x="0" y="0" width="1" height="1"/>
		</symbol>
		<symbol id="driving-wheel-as-use" viewBox="0 0 1 1">
			<use xlink:href="drivingwheel.svg#drivingwheel" x="0" y="0" width="1" height="1"/>
		</symbol>
	</defs>
</svg>

</head>
<body>

<h1><code>&lt;x-knob&gt;</code> bugs</h1>

<script type="text/javascript">
if (window.WebComponents) {
	document.writeln('<p style="color:red;">Note: <code>document.registerElement()</code> not detected, enabling the <a href="https://github.com/webcomponents/webcomponentsjs/releases">webcomponentsjs</a> polyfill.</p>');
}
</script>



<section id="bug-chromatic-wheel">
<h2><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1199538">Firefox bug 1199538</a>: Incorrect SVG text rendering when font-size is effectively smaller than 8px</h2>

<p>Each graphic below has width and height set to <output class="bug-chromatic-wheel-size-output"></output>px. Internally, the SVG <code>viewBox</code> dimensions are 10x10, and the text <code>font-size</code> is <code>0.4px</code>. Doing the math, this the actual <code>font-size</code> in document pixels is <output class="bug-chromatic-wheel-font-size-output"></output>px. If this number is smaller than 8px, then text rendering in Firefox is completely broken, with all characters drawn on top of each other. Sometimes (depending on the rotation) the characters is drawn at the wrong location.</p>

<p><label>Size: <input type="number" id="bug-chromatic-wheel-size" min="1" step="1" value="199">px</label>. Try <a href="javascript:set_chromatic_wheel_size(199)">199px</a> and <a href="javascript:set_chromatic_wheel_size(200)">200px</a>.</p>

<p>Current rotation is <output class="bug-chromatic-wheel-rotation-output"></output>deg. Change it by dragging the left-most wheel. Try <a href="javascript:set_chromatic_wheel_rotation(0)">0deg</a> and <a href="javascript:set_chromatic_wheel_rotation(0.25)">0.25deg</a> and <a href="javascript:set_chromatic_wheel_rotation(10)">10deg</a> and <a href="javascript:set_chromatic_wheel_rotation(90)">90deg</a>.</p>

<p>
	<x-knob id="bug-chromatic-wheel-x-knob" divisions="1440" svgsymbolid="chromatic-wheel-labeled" title="Interactive knob custom element with SVG inside the shadow DOM."></x-knob>
	<svg id="bug-chromatic-wheel-svg-use" viewBox="-1 -1 2 2" title="Plain SVG element with &lt;use&gt; pointing to a previously defined symbol.">
		<use xlink:href="#chromatic-wheel-labeled" x="-1" y="-1" width="2" height="2"/>
	</svg>
	<svg id="bug-chromatic-wheel-svg-inline" viewBox="-5 -5 10 10" title="Minimal SVG element with the text elements written inline as direct descendants.">
		<g text-anchor="middle" dominant-baseline="central" font-family="Arial, sans-serif" font-size="0.4px">
			<text x="0" y="-4.5" transform="rotate(0)">0</text>
			<text x="0" y="-4.5" transform="rotate(10)">10</text>
			<text x="0" y="-4.5" transform="rotate(20)">20</text>
			<text x="0" y="-4.5" transform="rotate(30)">30</text>
			<text x="0" y="-4.5" transform="rotate(40)">40</text>
			<text x="0" y="-4.5" transform="rotate(50)">50</text>
			<text x="0" y="-4.5" transform="rotate(60)">60</text>
			<text x="0" y="-4.5" transform="rotate(70)">70</text>
			<text x="0" y="-4.5" transform="rotate(80)">80</text>
			<text x="0" y="-4.5" transform="rotate(90)">90</text>
			<text x="0" y="-4.5" transform="rotate(100)">100</text>
			<text x="0" y="-4.5" transform="rotate(110)">110</text>
			<text x="0" y="-4.5" transform="rotate(120)">120</text>
			<text x="0" y="-4.5" transform="rotate(130)">130</text>
			<text x="0" y="-4.5" transform="rotate(140)">140</text>
			<text x="0" y="-4.5" transform="rotate(150)">150</text>
			<text x="0" y="-4.5" transform="rotate(160)">160</text>
			<text x="0" y="-4.5" transform="rotate(170)">170</text>
			<text x="0" y="-4.5" transform="rotate(180)">180</text>
			<text x="0" y="-4.5" transform="rotate(190)">190</text>
			<text x="0" y="-4.5" transform="rotate(200)">200</text>
			<text x="0" y="-4.5" transform="rotate(210)">210</text>
			<text x="0" y="-4.5" transform="rotate(220)">220</text>
			<text x="0" y="-4.5" transform="rotate(230)">230</text>
			<text x="0" y="-4.5" transform="rotate(240)">240</text>
			<text x="0" y="-4.5" transform="rotate(250)">250</text>
			<text x="0" y="-4.5" transform="rotate(260)">260</text>
			<text x="0" y="-4.5" transform="rotate(270)">270</text>
			<text x="0" y="-4.5" transform="rotate(280)">280</text>
			<text x="0" y="-4.5" transform="rotate(290)">290</text>
			<text x="0" y="-4.5" transform="rotate(300)">300</text>
			<text x="0" y="-4.5" transform="rotate(310)">310</text>
			<text x="0" y="-4.5" transform="rotate(320)">320</text>
			<text x="0" y="-4.5" transform="rotate(330)">330</text>
			<text x="0" y="-4.5" transform="rotate(340)">340</text>
			<text x="0" y="-4.5" transform="rotate(350)">350</text>
		</g>
	</svg>
</p>

<style type="text/css">
#bug-chromatic-wheel p x-knob,
#bug-chromatic-wheel p svg {
	/* Default sizes to avoid popping during page load. They will be overridden by update_chromatic_wheel() function. */
	width: 200px;
	height: 200px;
}
</style>

<script type="text/javascript">
function set_chromatic_wheel_size(size) {
	document.getElementById('bug-chromatic-wheel-size').value = size;
	update_chromatic_wheel();
}
function set_chromatic_wheel_rotation(degrees) {
	document.getElementById('bug-chromatic-wheel-x-knob').value = degrees / 360;
	update_chromatic_wheel();
}
function update_chromatic_wheel() {
	var size = document.getElementById('bug-chromatic-wheel-size').value;
	var rotation = document.getElementById('bug-chromatic-wheel-x-knob').value * 360;
	[
		document.getElementById('bug-chromatic-wheel-x-knob'),
		document.getElementById('bug-chromatic-wheel-svg-use'),
		document.getElementById('bug-chromatic-wheel-svg-inline'),
	].forEach(function(curr, index, arr) {
		curr.style.width = size + 'px';
		curr.style.height = size + 'px';
	});
	[
		document.getElementById('bug-chromatic-wheel-svg-use'),
		document.getElementById('bug-chromatic-wheel-svg-inline'),
	].forEach(function(curr, index, arr) {
		curr.children[0].style.transform = 'rotate(' + rotation + 'deg)';
	});
	Array.prototype.forEach.call(
		document.getElementsByClassName('bug-chromatic-wheel-size-output'),
		function(curr, index, arr) {
			curr.value = size;
		}
	);
	Array.prototype.forEach.call(
		document.getElementsByClassName('bug-chromatic-wheel-font-size-output'),
		function(curr, index, arr) {
			curr.value = (0.4 * size / 10).toFixed(3);
		}
	);
	Array.prototype.forEach.call(
		document.getElementsByClassName('bug-chromatic-wheel-rotation-output'),
		function(curr, index, arr) {
			curr.value = rotation.toFixed(2);
		}
	);
}
function init_chromatic_wheel() {
	document.getElementById('bug-chromatic-wheel-size').addEventListener('input', update_chromatic_wheel);
	document.getElementById('bug-chromatic-wheel-x-knob').addEventListener('input', update_chromatic_wheel);
	update_chromatic_wheel();
}
window.addEventListener('load', init_chromatic_wheel);
</script>

</section>



<section id="bug-tinted-image-background">
<h2><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1199536">Firefox bug 1199536</a>: Tinted image background in external SVG included via SVG &lt;image&gt; tag</h2>

<p>We have an external <a href="drivingwheel.svg">drivingwheel.svg</a> file (<a href="https://openclipart.org/detail/172010/driving-wheel">from Open clipart</a>) that is being included below in several ways.</p>

<p>In Firefox, loading this external SVG file inside <code>&lt;image xlink:href="drivingwheel.svg"/&gt;</code> is buggy, because the background gets filled with a semi-transparent shade of gray.</p>

<p>Loading the same SVG image using HTML <code>&lt;img&gt;</code> or <code>&lt;object&gt;</code> works as expected. Using the same SVG image as CSS <code>background-image</code> also works as expected.</p>

<p class="testcase">
	<x-knob svgsymbolid="driving-wheel-as-image" title="x-knob element with SVG &lt;image&gt; inside a &lt;symbol&gt; being referenced by &lt;use&gt; inside shadow DOM."></x-knob>
	<svg viewBox="-1 -1 2 2" title="Plain SVG element with &lt;image&gt; inside a &lt;symbol&gt; being referenced by &lt;use&gt;.">
		<use xlink:href="#driving-wheel-as-image" x="-1" y="-1" width="2" height="2"/>
	</svg>
	<svg viewBox="0 0 1 1" title="Plain SVG element with &lt;image&gt; loading the external SVG file.">
		<image xlink:href="drivingwheel.svg" x="0" y="0" width="1" height="1"/>
	</svg>
	<img src="drivingwheel.svg" title="Plain HTML &lt;img&gt; element loading the external SVG file.">
	<object data="drivingwheel.svg" type="text/svg+xml" title="Plain HTML &lt;object&gt; element loading the external SVG file."></object>
</p>

<style type="text/css">
#bug-tinted-image-background p.testcase {
	background-image: url(drivingwheel.svg);
	background-size: 32px 32px;
	background-repeat: repeat-x;
}
#bug-tinted-image-background .testcase > x-knob,
#bug-tinted-image-background .testcase > svg,
#bug-tinted-image-background .testcase > img,
#bug-tinted-image-background .testcase > object {
	display: inline-block;
	width: 128px;
	height: 128px;
}
</style>

</section>



<section id="bug-use-external-svg">
<h2><a href="http://crbug.com/109212">Chrome bug 109212</a>: &lt;use&gt; does not render correctly if pointing to an external SVG that contains "url(#some_id)"</h2>

<p>If we have an external SVG file, we can use <code>&lt;use xlink:href="foo.svg#bar"&gt;</code> to include it (or some elements from it) into an SVG element.</p>

<p>However, if this external SVG file defines stuff such as filters and gradients, and uses such stuff to render other elements (e.g. <code>fill="url(#gradient)"</code>); then Chrome will not resolve these external IDs correctly, failing to render the imported file correctly.</p>

<p>It is worth noting that <code>url(#foo)</code> will fail rendering, but <code>&lt;use xlink:href="#bar"&gt;</code> is resolved correctly.</p>

<p>As a bonus bug, the <code>title=""</code> tooltip does not show up in these &lt;svg&gt; elements.</p>

<p class="testcase">
	<img src="drivingwheel.svg" title="drivingwheel.svg being included through &lt;img&gt;.">
	<svg viewBox="0 0 1 1" title="drivingwheel.svg being included through &lt;use&gt;.">
		<use xlink:href="drivingwheel.svg#drivingwheel" x="0" y="0" width="1" height="1"/>
	</svg>
	<img src="bugs-external-file.svg" title="Sample SVG file being included through &lt;img&gt;.">
	<svg viewBox="0 0 1 1" title="Sample SVG file being included through &lt;img&gt;.">
		<use xlink:href="bugs-external-file.svg#svg" x="0" y="0" width="1" height="1"/>
	</svg>
	<svg viewBox="0 0 16 16" title="One element from the external SVG file being included through &lt;img&gt;.">
		<use xlink:href="bugs-external-file.svg#circle" x="0" y="0" width="16" height="16"/>
	</svg>
	<svg viewBox="0 0 16 16" title="One element from the external SVG file being included through &lt;img&gt;, having a stroke color being applied..">
		<use xlink:href="bugs-external-file.svg#circle" x="0" y="0" width="16" height="16" stroke="green"/>
	</svg>
</p>

<style type="text/css">
#bug-use-external-svg .testcase > img,
#bug-use-external-svg .testcase > svg {
	display: inline-block;
	width: 128px;
	height: 128px;
	outline: 1px dotted gray;
}

</style>

</section>



</body>
</html>
